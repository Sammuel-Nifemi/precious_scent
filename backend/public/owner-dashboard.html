<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Owner Dashboard - Precious Scent</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg: #fff6fb;
      --sidebar: #f8d6e7; /* soft pink */
      --accent: #d08b9c;  /* deeper pink */
      --gold: #c99a54;
      --text: #2b2b2b;
      --muted: #6b6b6b;
    }

    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}

    body{
      margin:0;
      background: linear-gradient(180deg,var(--bg),#fff);
      color:var(--text);
      min-height:100vh;
      display:flex;
    }

    /* Sidebar */
    .sidebar{
      width:260px;
      background:linear-gradient(180deg,var(--sidebar),#fff);
      padding:22px;
      border-right:1px solid rgba(0,0,0,0.04);
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .brand{
      display:flex;gap:12px;align-items:center;
    }
    .brand .logo{
      height:46px;width:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--gold));
      display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
    }
    .brand h1{font-size:18px;margin:0}
    .sidebar nav{margin-top:6px;}
    .nav-link{
      display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:var(--text);text-decoration:none;
      cursor:pointer;
    }
    .nav-link:hover{background:rgba(0,0,0,0.03)}
    .nav-link.active{background:linear-gradient(90deg,var(--accent),var(--gold));color:white}

    .logout{
      margin-top:auto;padding:10px;border-radius:10px;border:0;background:var(--text);color:white;cursor:pointer;
      box-shadow:0 6px 12px rgba(0,0,0,0.08);
    }

    /* Main */
    .wrap{
      flex:1;padding:28px;
    }

    .top-row{
      display:flex;justify-content:space-between;align-items:center;gap:20px;margin-bottom:18px;
    }
    .top-row h2{margin:0}

    .cards{
      display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px;
    }
    .card{
      background:white;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.04);
    }
    .card .value{font-size:20px;font-weight:700}
    .card .label{font-size:12px;color:var(--muted);margin-top:6px}

    .main-grid{
      display:grid;grid-template-columns:2fr 1fr;gap:18px;
    }

    .panel{
      background:white;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.04);
    }

    table{width:100%;border-collapse:collapse;font-size:14px}
    th, td{padding:8px;text-align:left;border-bottom:1px solid #f0f0f0}
    th{font-weight:700;font-size:13px}
    .btn{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--gold));color:white}
    .btn-ghost{background:transparent;border:1px solid #ececec}
    .muted{color:var(--muted);font-size:13px}

    /* small screens */
    @media (max-width:980px){
      .cards{grid-template-columns:repeat(2,1fr)}
      .main-grid{grid-template-columns:1fr}
      .sidebar{display:none}
      body{padding:16px}
    }

    /* small helpers */
    .flex{display:flex;gap:10px;align-items:center}
    .tiny{font-size:12px;color:var(--muted)}
    .img-thumb{width:50px;height:50px;object-fit:cover;border-radius:8px;border:1px solid #eee}
    .input, textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #eee}
    textarea{min-height:90px;resize:vertical}
    .right{margin-left:auto}
    .center{text-align:center}
    .small{font-size:13px}
    .danger{background:#ffebeb;color:#b40000}
    .success{background:#eafeea;color:#0b7a12}
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside class="sidebar" aria-label="Sidebar">
    <div class="brand">
      <div class="logo">PS</div>
      <div>
        <h1 id="brandNameDisplay">Precious Scent</h1>
        <div class="tiny" id="brandTag">Luxury Fragrance</div>
      </div>
    </div>

    <nav>
      <div class="nav-link active" data-target="dashboard" id="link-dashboard">Dashboard</div>
      <div class="nav-link" data-target="orders" id="link-orders">Orders</div>
      <div class="nav-link" data-target="products" id="link-products">Products</div>
      <div class="nav-link" data-target="staff" id="link-staff">Staff</div>
      <div class="nav-link" data-target="settings" id="link-settings">Store Settings</div>
      <div class="nav-link" data-target="password" id="link-password">Change Password</div>
    </nav>

    <button class="logout" id="ownerLogout">Logout</button>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="wrap">
    <div class="top-row">
      <div>
        <h2 id="pageTitle">Dashboard</h2>
        <div class="tiny" id="pageSubtitle">Overview & analytics</div>
      </div>
      <div class="flex">
        <div class="tiny">Signed in as <strong id="ownerName">Owner</strong></div>
        <button class="btn btn-ghost" id="seedDataBtn" title="(re)seed demo data">Seed demo data</button>
      </div>
    </div>

    <!-- Cards -->
    <div class="cards" id="metricCards">
      <div class="card">
        <div class="label">Total Sales</div>
        <div class="value" id="totalSales">₦0</div>
        <div class="tiny">All time</div>
      </div>
      <div class="card">
        <div class="label">Total Orders</div>
        <div class="value" id="totalOrders">0</div>
        <div class="tiny">All time</div>
      </div>
      <div class="card">
        <div class="label">Total Customers</div>
        <div class="value" id="totalCustomers">0</div>
        <div class="tiny">Active customers</div>
      </div>
      <div class="card">
        <div class="label">Total Products</div>
        <div class="value" id="totalProducts">0</div>
        <div class="tiny">Available items</div>
      </div>
    </div>

    <div class="main-grid">

      <!-- LEFT: Chart + Recent Orders -->
      <div>
        <div class="panel" id="dashboardPanel">
          <canvas id="revenueChart" height="160"></canvas>
        </div>

        <div class="panel" style="margin-top:14px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <h3 style="margin:0">Recent Orders</h3>
            <div class="tiny muted">Newest first</div>
          </div>

          <div id="recentOrdersArea"></div>
        </div>
      </div>

      <!-- RIGHT: Quick actions / area that switches based on nav -->
      <div>
        <div class="panel" id="rightPanel">
          <!-- content swapped dynamically -->
          <div id="rightContent" class="center">
            <p class="muted">Use the menu to manage orders, products, staff and settings.</p>
            <div style="margin-top:12px">
              <button class="btn btn-primary" id="goManageProducts">Manage Products</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

<script>
/* =========================
   Persistent Storage Helpers
   ========================= */
function get(key){ return JSON.parse(localStorage.getItem(key) || 'null'); }
function set(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
function ensureInit(){
  // owner info (password stored as plain text for demo only!)
  if(!get('owner')) {
    set('owner', { username: 'owner', name: 'Store Owner', password: 'admin123' });
  }
  if(!get('products')) set('products', []);
  if(!get('orders')) set('orders', []);
  if(!get('customers')) set('customers', []);
  if(!get('staff')) set('staff', []);
}
ensureInit();

/* =========================
   DEMO SEED DATA
   ========================= */
function seedDemoData(){
  const sampleProducts = [
    { id:genId(), name:'Her Fragrance', price:10000, image:'https://via.placeholder.com/150?text=Her', description:'Floral and elegant.' },
    { id:genId(), name:'His Cologne', price:12000, image:'https://via.placeholder.com/150?text=His', description:'Fresh and woody.' },
    { id:genId(), name:'Body Mist', price:5000, image:'https://via.placeholder.com/150?text=Body+Mist', description:'Light everyday scent.' }
  ];
  const sampleCustomers = [
    { id:genId(), name:'Aisha', phone:'08012345678', address:'Lagos' },
    { id:genId(), name:'Tunde', phone:'08098765432', address:'Abuja' }
  ];
  const sampleOrders = [
    { id:genId(), name:'Aisha', phone:'08012345678', address:'Lagos', items:['Her Fragrance x1'], total:10000, status:'Pending', date: daysAgo(1) },
    { id:genId(), name:'Tunde', phone:'08098765432', address:'Abuja', items:['His Cologne x1','Body Mist x1'], total:17000, status:'Processing', date: daysAgo(3) }
  ];
  const sampleStaff = [
    { id:genId(), username:'staff1', name:'Mary', role:'staff', phone:'08011112222' }
  ];
  set('products', sampleProducts);
  set('customers', sampleCustomers);
  set('orders', sampleOrders);
  set('staff', sampleStaff);
  alert('Demo data seeded!');
  renderAll();
}

/* =========================
   Utilities
   ========================= */
function genId(){ return 'id_' + Math.random().toString(36).slice(2,10); }
function formatCurrency(n){ return '₦' + Number(n).toLocaleString(); }
function daysAgo(n){ let d=new Date(); d.setDate(d.getDate()-n); return d.toISOString(); }

/* =========================
   Dashboard Metrics & Chart
   ========================= */
let revenueChart = null;
function computeMetrics() {
  const products = get('products') || [];
  const orders = get('orders') || [];
  const customers = get('customers') || [];

  const totalSales = (orders.reduce((s,o)=>s + (Number(o.total)||0), 0));
  const metrics = {
    totalSales,
    totalOrders: orders.length,
    totalCustomers: customers.length,
    totalProducts: products.length
  };
  return metrics;
}

function renderCards() {
  const m = computeMetrics();
  document.getElementById('totalSales').textContent = formatCurrency(m.totalSales);
  document.getElementById('totalOrders').textContent = m.totalOrders;
  document.getElementById('totalCustomers').textContent = m.totalCustomers;
  document.getElementById('totalProducts').textContent = m.totalProducts;
}

function prepareChartData(){
  // Chart: sales per day for past 7 days
  const orders = get('orders') || [];
  const labels = [];
  const data = [];
  for(let i=6;i>=0;i--){
    const day = new Date(); day.setDate(day.getDate()-i);
    const label = day.toLocaleDateString();
    labels.push(label);
    const dayStart = new Date(day); dayStart.setHours(0,0,0,0);
    const dayEnd = new Date(day); dayEnd.setHours(23,59,59,999);
    const total = orders.filter(o=>{
      const date = new Date(o.date || o.createdAt || null);
      return date >= dayStart && date <= dayEnd;
    }).reduce((s,o)=>s + Number(o.total||0), 0);
    data.push(total);
  }
  return { labels, data };
}

function renderChart(){
  const ctx = document.getElementById('revenueChart').getContext('2d');
  const chartData = prepareChartData();
  if(revenueChart) revenueChart.destroy();
  revenueChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: chartData.labels,
      datasets: [{
        label: 'Revenue (₦)',
        data: chartData.data,
        borderRadius:6,
        backgroundColor: '#e7a9b9'
      }]
    },
    options: {
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{ y:{ ticks:{ callback: value => '₦' + value.toLocaleString() } } }
    }
  });
}

/* =========================
   Recent Orders
   ========================= */
function renderRecentOrders(){
  const orders = (get('orders') || []).slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
  const container = document.getElementById('recentOrdersArea');
  if(!orders.length){
    container.innerHTML = '<div class="muted">No orders yet.</div>';
    return;
  }
  let html = `<table><thead><tr><th>Order</th><th>Customer</th><th>Total</th><th>Status</th><th></th></tr></thead><tbody>`;
  orders.slice(0,8).forEach(o=>{
    html += `<tr>
      <td class="small">${(new Date(o.date)).toLocaleString()}</td>
      <td>${o.name}<div class="tiny">${o.phone}</div></td>
      <td>${formatCurrency(o.total)}</td>
      <td>
        <select onchange="changeOrderStatus('${o.id}', this.value)">
          <option ${o.status==='Pending'?'selected':''}>Pending</option>
          <option ${o.status==='Processing'?'selected':''}>Processing</option>
          <option ${o.status==='Completed'?'selected':''}>Completed</option>
        </select>
      </td>
      <td><button class="btn btn-ghost" onclick="viewOrderDetail('${o.id}')">View</button></td>
    </tr>`;
  });
  html += `</tbody></table>`;
  container.innerHTML = html;
}

function changeOrderStatus(id, newStatus){
  const orders = get('orders') || [];
  const idx = orders.findIndex(o=>o.id===id);
  if(idx===-1) return alert('Order not found');
  orders[idx].status = newStatus;
  set('orders', orders);
  renderAll();
}

/* =========================
   Right Panel Navigation & Views
   ========================= */
function showPanel(name){
  // Update nav active
  document.querySelectorAll('.nav-link').forEach(el=>el.classList.remove('active'));
  const activeLink = document.querySelector(`[data-target="${name}"]`);
  if(activeLink) activeLink.classList.add('active');

  document.getElementById('pageTitle').textContent = {
    dashboard:'Dashboard',
    orders:'Orders',
    products:'Products',
    staff:'Staff',
    settings:'Store Settings',
    password:'Change Password'
  }[name] || 'Dashboard';

  const rightContent = document.getElementById('rightContent');
  if(name === 'dashboard'){
    rightContent.innerHTML = `<div class="center muted">System quick actions</div>
    <div style="margin-top:12px" class="flex">
      <button class="btn btn-primary" onclick="renderAll()">Refresh</button>
      <button class="btn btn-ghost" onclick="seedDemoData()">Seed Demo Data</button>
    </div>`;
  }
  else if(name === 'orders'){
    rightContent.innerHTML = `<h3>All Orders</h3><div id="ordersList"></div>`;
    renderOrdersManagement();
  }
  else if(name === 'products'){
    rightContent.innerHTML = `<h3>Manage Products</h3>
      <div style="margin-bottom:8px"><button class="btn btn-primary" onclick="openAddProductForm()">Add New Product</button></div>
      <div id="productsList"></div>`;
    renderProductsManagement();
  }
  else if(name === 'staff'){
    rightContent.innerHTML = `<h3>Manage Staff</h3>
      <div style="margin-bottom:8px"><button class="btn btn-primary" onclick="openAddStaffForm()">Add Staff</button></div>
      <div id="staffList"></div>`;
    renderStaffManagement();
  }
  else if(name === 'settings'){
    rightContent.innerHTML = `<h3>Store Settings</h3><div id="settingsArea"></div>`;
    renderSettings();
  }
  else if(name === 'password'){
    rightContent.innerHTML = `<h3>Change Password</h3><div id="passwordArea"></div>`;
    renderPasswordArea();
  }
}

/* =========================
   Orders Admin
   ========================= */
function renderOrdersManagement(){
  const orders = (get('orders') || []).slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
  const el = document.getElementById('ordersList');
  if(!orders.length) { el.innerHTML = '<div class="muted">No orders</div>'; return; }
  let html = `<table><thead><tr><th>Date</th><th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead><tbody>`;
  orders.forEach(o=>{
    html += `<tr>
      <td class="small">${(new Date(o.date)).toLocaleString()}</td>
      <td>${o.name}<div class="tiny">${o.phone} — ${o.address}</div></td>
      <td class="small">${o.items.join('<br>')}</td>
      <td>${formatCurrency(o.total)}</td>
      <td>
        <select onchange="changeOrderStatus('${o.id}', this.value)">
          <option ${o.status==='Pending'?'selected':''}>Pending</option>
          <option ${o.status==='Processing'?'selected':''}>Processing</option>
          <option ${o.status==='Completed'?'selected':''}>Completed</option>
        </select>
      </td>
      <td>
        <button class="btn btn-ghost" onclick="viewOrderDetail('${o.id}')">View</button>
        <button class="btn danger" onclick="deleteOrder('${o.id}')">Delete</button>
      </td>
    </tr>`;
  });
  html += `</tbody></table>`;
  el.innerHTML = html;
}

function viewOrderDetail(id){
  const orders = get('orders') || [];
  const o = orders.find(x=>x.id===id);
  if(!o) return alert('Order not found');
  // render modal-like content in right panel
  const rc = document.getElementById('rightContent');
  rc.innerHTML = `<h3>Order Details</h3>
    <div><strong>Date:</strong> ${(new Date(o.date)).toLocaleString()}</div>
    <div><strong>Customer:</strong> ${o.name} | ${o.phone}</div>
    <div><strong>Address:</strong> ${o.address}</div>
    <div><strong>Items:</strong><ul>${o.items.map(it=>'<li>'+it+'</li>').join('')}</ul></div>
    <div><strong>Total:</strong> ${formatCurrency(o.total)}</div>
    <div><strong>Status:</strong> 
      <select onchange="changeOrderStatus('${o.id}', this.value)">
        <option ${o.status==='Pending'?'selected':''}>Pending</option>
        <option ${o.status==='Processing'?'selected':''}>Processing</option>
        <option ${o.status==='Completed'?'selected':''}>Completed</option>
      </select>
    </div>
    <div style="margin-top:12px">
      <button class="btn btn-primary" onclick="showPanel('orders')">Back to orders</button>
    </div>`;
}

function deleteOrder(id){
  if(!confirm('Delete this order?')) return;
  let orders = get('orders') || [];
  orders = orders.filter(o=>o.id!==id);
  set('orders', orders);
  renderAll();
}

/* =========================
   Products Admin
   ========================= */
function renderProductsManagement(){
  const prods = get('products') || [];
  const el = document.getElementById('productsList');
  if(!prods.length){ el.innerHTML = '<div class="muted">No products yet.</div>'; return; }
  let html = `<table><thead><tr><th>Image</th><th>Name</th><th>Price</th><th>Description</th><th>Actions</th></tr></thead><tbody>`;
  prods.forEach(p=>{
    html += `<tr>
      <td><img src="${p.image}" class="img-thumb" alt="${p.name}"></td>
      <td>${p.name}</td>
      <td>${formatCurrency(p.price)}</td>
      <td class="small">${p.description}</td>
      <td>
        <button class="btn btn-ghost" onclick="openEditProductForm('${p.id}')">Edit</button>
        <button class="btn danger" onclick="deleteProduct('${p.id}')">Delete</button>
      </td>
    </tr>`;
  });
  html += `</tbody></table>`;
  el.innerHTML = html;
}

function openAddProductForm(){
  const rc = document.getElementById('rightContent');
  rc.innerHTML = `<h3>Add Product</h3>
  <div>
    <label class="tiny">Name</label>
    <input class="input" id="p_name">
    <label class="tiny">Price (₦)</label>
    <input class="input" id="p_price" type="number">
    <label class="tiny">Image URL</label>
    <input class="input" id="p_image">
    <label class="tiny">Description</label>
    <textarea id="p_desc" class="input"></textarea>
    <div style="margin-top:8px">
      <button class="btn btn-primary" onclick="submitAddProduct()">Save Product</button>
      <button class="btn btn-ghost" onclick="showPanel('products')">Cancel</button>
    </div>
  </div>`;
}

function submitAddProduct(){
  const name = document.getElementById('p_name').value.trim();
  const price = Number(document.getElementById('p_price').value || 0);
  const image = document.getElementById('p_image').value.trim() || 'https://via.placeholder.com/150';
  const desc = document.getElementById('p_desc').value.trim();

  if(!name || !price) return alert('Name and price are required');
  const prods = get('products') || [];
  prods.push({ id:genId(), name, price, image, description:desc });
  set('products', prods);
  alert('Product added');
  showPanel('products');
  renderAll();
}

function openEditProductForm(id){
  const prods = get('products') || [];
  const p = prods.find(x=>x.id===id);
  if(!p) return alert('Product not found');
  const rc = document.getElementById('rightContent');
  rc.innerHTML = `<h3>Edit Product</h3>
  <div>
    <label class="tiny">Name</label>
    <input class="input" id="ep_name" value="${p.name}">
    <label class="tiny">Price (₦)</label>
    <input class="input" id="ep_price" type="number" value="${p.price}">
    <label class="tiny">Image URL</label>
    <input class="input" id="ep_image" value="${p.image}">
    <label class="tiny">Description</label>
    <textarea id="ep_desc" class="input">${p.description}</textarea>
    <div style="margin-top:8px">
      <button class="btn btn-primary" onclick="submitEditProduct('${p.id}')">Save Changes</button>
      <button class="btn btn-ghost" onclick="showPanel('products')">Cancel</button>
    </div>
  </div>`;
}

function submitEditProduct(id){
  const prods = get('products') || [];
  const idx = prods.findIndex(p=>p.id===id);
  if(idx===-1) return alert('Not found');
  prods[idx].name = document.getElementById('ep_name').value.trim();
  prods[idx].price = Number(document.getElementById('ep_price').value || 0);
  prods[idx].image = document.getElementById('ep_image').value.trim();
  prods[idx].description = document.getElementById('ep_desc').value.trim();
  set('products', prods);
  alert('Product updated');
  showPanel('products');
  renderAll();
}

function deleteProduct(id){
  if(!confirm('Delete product?')) return;
  let prods = get('products') || [];
  prods = prods.filter(p=>p.id!==id);
  set('products', prods);
  renderAll();
  showPanel('products');
}

/* =========================
   Staff Admin
   ========================= */
function renderStaffManagement(){
  const staff = get('staff') || [];
  const el = document.getElementById('staffList');
  if(!staff.length){ el.innerHTML = '<div class="muted">No staff accounts.</div>'; return; }
  let html = `<table><thead><tr><th>Name</th><th>Username</th><th>Phone</th><th>Role</th><th>Actions</th></tr></thead><tbody>`;
  staff.forEach(s=>{
    html += `<tr>
      <td>${s.name}</td>
      <td>${s.username}</td>
      <td class="tiny">${s.phone||'-'}</td>
      <td>${s.role||'staff'}</td>
      <td>
        <button class="btn btn-ghost" onclick="openEditStaffForm('${s.id}')">Edit</button>
        <button class="btn danger" onclick="deleteStaff('${s.id}')">Delete</button>
      </td>
    </tr>`;
  });
  html += `</tbody></table>`;
  el.innerHTML = html;
}

function openAddStaffForm(){
  const rc = document.getElementById('rightContent');
  rc.innerHTML = `<h3>Add Staff</h3>
    <div>
      <label class="tiny">Name</label><input class="input" id="s_name">
      <label class="tiny">Username</label><input class="input" id="s_un">
      <label class="tiny">Phone</label><input class="input" id="s_phone">
      <label class="tiny">Password</label><input class="input" id="s_pass" type="password">
      <div style="margin-top:8px">
        <button class="btn btn-primary" onclick="submitAddStaff()">Create</button>
        <button class="btn btn-ghost" onclick="showPanel('staff')">Cancel</button>
      </div>
    </div>`;
}

function submitAddStaff(){
  const name = document.getElementById('s_name').value.trim();
  const username = document.getElementById('s_un').value.trim();
  const phone = document.getElementById('s_phone').value.trim();
  const pass = document.getElementById('s_pass').value || 'password';

  if(!name || !username) return alert('Name and username required');
  const staff = get('staff') || [];
  if(staff.find(s=>s.username===username)) return alert('Username exists');
  staff.push({ id:genId(), name, username, phone, password:pass, role:'staff' });
  set('staff', staff);
  alert('Staff added');
  showPanel('staff');
  renderAll();
}

function openEditStaffForm(id){
  const staff = get('staff') || [];
  const s = staff.find(x=>x.id===id);
  if(!s) return alert('Not found');
  const rc = document.getElementById('rightContent');
  rc.innerHTML = `<h3>Edit Staff</h3>
    <div>
      <label class="tiny">Name</label><input class="input" id="es_name" value="${s.name}">
      <label class="tiny">Phone</label><input class="input" id="es_phone" value="${s.phone||''}">
      <label class="tiny">Password (leave to keep)</label><input class="input" id="es_pass" type="password">
      <div style="margin-top:8px">
        <button class="btn btn-primary" onclick="submitEditStaff('${s.id}')">Save</button>
        <button class="btn btn-ghost" onclick="showPanel('staff')">Cancel</button>
      </div>
    </div>`;
}

function submitEditStaff(id){
  const staff = get('staff') || [];
  const idx = staff.findIndex(s=>s.id===id);
  if(idx===-1) return alert('Not found');
  staff[idx].name = document.getElementById('es_name').value.trim();
  staff[idx].phone = document.getElementById('es_phone').value.trim();
  const pass = document.getElementById('es_pass').value;
  if(pass) staff[idx].password = pass;
  set('staff', staff);
  alert('Staff updated');
  showPanel('staff');
  renderAll();
}

function deleteStaff(id){
  if(!confirm('Remove staff member?')) return;
  let staff = get('staff') || [];
  staff = staff.filter(s=>s.id!==id);
  set('staff', staff);
  renderAll();
  showPanel('staff');
}

/* =========================
   Settings & Password
   ========================= */
function renderSettings(){
  const owner = get('owner') || {};
  const brand = localStorage.getItem('store_brand') || 'Precious Scent';
  const tagline = localStorage.getItem('store_tag') || 'Luxury Fragrance';
  const contact = localStorage.getItem('store_contact') || 'contact@precious-scent.ng';

  const area = document.getElementById('settingsArea');
  area.innerHTML = `<label class="tiny">Brand Name</label>
    <input class="input" id="set_brand" value="${brand}">
    <label class="tiny">Tagline</label>
    <input class="input" id="set_tag" value="${tagline}">
    <label class="tiny">Contact (email or phone)</label>
    <input class="input" id="set_contact" value="${contact}">
    <div style="margin-top:8px">
      <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
      <button class="btn btn-ghost" onclick="showPanel('dashboard')">Cancel</button>
    </div>`;
}

function saveSettings(){
  const b = document.getElementById('set_brand').value.trim() || 'Precious Scent';
  const t = document.getElementById('set_tag').value.trim() || '';
  const c = document.getElementById('set_contact').value.trim() || '';
  localStorage.setItem('store_brand', b);
  localStorage.setItem('store_tag', t);
  localStorage.setItem('store_contact', c);
  document.getElementById('brandNameDisplay').textContent = b;
  document.getElementById('brandTag').textContent = t;
  alert('Settings saved');
  showPanel('settings');
}

function renderPasswordArea(){
  const area = document.getElementById('passwordArea');
  area.innerHTML = `<label class="tiny">Current password</label>
    <input class="input" id="cur_pass" type="password">
    <label class="tiny">New password</label>
    <input class="input" id="new_pass" type="password">
    <label class="tiny">Confirm new password</label>
    <input class="input" id="conf_pass" type="password">
    <div style="margin-top:8px">
      <button class="btn btn-primary" onclick="changePassword()">Change Password</button>
    </div>`;
}

function changePassword(){
  const cur = document.getElementById('cur_pass').value;
  const nw = document.getElementById('new_pass').value;
  const cf = document.getElementById('conf_pass').value;
  const owner = get('owner') || {};
  if(cur !== (owner.password || '')) return alert('Current password incorrect');
  if(!nw || nw !== cf) return alert('New passwords do not match or empty');
  owner.password = nw;
  set('owner', owner);
  alert('Password changed');
  showPanel('password');
}

/* =========================
   Global render helper
   ========================= */
function renderAll(){
  renderCards();
  renderChart();
  renderRecentOrders();
  // if right panel is currently a management view, re-render it
  const active = document.querySelector('.nav-link.active')?.dataset?.target || 'dashboard';
  showPanel(active);
  // display brand info
  document.getElementById('brandNameDisplay').textContent = localStorage.getItem('store_brand') || 'Precious Scent';
  document.getElementById('brandTag').textContent = localStorage.getItem('store_tag') || 'Luxury Fragrance';
}

/* =========================
   Event bindings & init
   ========================= */
document.getElementById('seedDataBtn').addEventListener('click', seedDemoData);
document.getElementById('goManageProducts').addEventListener('click', ()=>{ showPanel('products'); });
document.getElementById('ownerLogout').addEventListener('click', ()=>{
  // simple logout simulation
  alert('Logged out (demo).');
  // in real app, redirect to login and clear session
});

document.querySelectorAll('.nav-link').forEach(el=>{
  el.addEventListener('click', ()=> showPanel(el.dataset.target));
});

// initial render: seed a tiny sample if absolutely empty so charts show something useful
(function initOnce(){
  ensureInit();
  // if everything empty, seed minimal demo data
  const products = get('products') || [];
  const orders = get('orders') || [];
  const customers = get('customers') || [];
  if(!products.length && !orders.length && !customers.length){
    // do not force seed — leave the seed button for the owner.
    // but create a tiny placeholder order for visual balance:
    // nothing by default
  }
  renderAll();
})();

</script>
</body>
</html>
